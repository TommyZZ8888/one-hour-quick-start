## 1.数据恢复命令

MinIO 会定期执行对象修复，自动修复因静默 bitrot 损坏、磁盘故障或 POST/GET 上的其他问题而损坏的对象。

在更换硬盘或者加入新节点时，也可以手动执行恢复操作。当然，这可能会占用很大的系统资源。

```bash
#执行所有对象
mc admin heal -r my-minio

#修复某个bucket
mc admin heal -r my-minio/my-bucket
```

提示：`mc admin heal my-minio`不执行修复操作，而是查看是否有正在执行的修复进程和状态，加上 -r 参数才是执行状态修复

## 2.更换硬盘并修复

在虚拟机minio2中删除minio2_disk2,并加入一块新的硬盘minio2_newdisk

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1653269875461-560a57f3-9aed-47dc-a44d-f6c20eefa02e.png)

由于磁盘损坏，minio2启动时系统自检报错，会进入紧急模式（**emergency mode**）

运行` df -h `，此时系统里已经看不到/mnt/disk4

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1653273072931-266389e5-55b9-47f5-8f68-8e4f7b91c3cb.png)

- 格式化新硬盘

`fdisk -l`查看新硬盘设备名称

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1653273336976-f3b43b54-eb80-4bbb-92d2-b5723bb6c8db.png)

- 格式化磁盘

```bash
mkfs.xfs /dev/sdc
```

- 修改 /etc/fstab

查看/dev/sdc的uuid

```bash
blkid /dev/sdc
```

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1653274474180-161bcc0c-458f-4a08-a653-635f4dd9f206.png)

修改/etc/fstab中/mnt/disk4的uuid

![img](https://cdn.nlark.com/yuque/0/2022/png/28915315/1653274777403-0fd8d0da-0443-4166-b409-7387012be96b.png)

重启系统后，执行修复命令,修复前需要更改磁盘权限

注意：切记不要忘记修改磁盘目录的权限，不然磁盘不会修复成功

```bash
#修改磁盘权限
sudo chown minio-user:minio-user /mnt/disk4

#执行修复命令
mc admin heal -r my-minio
```

## 

|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |
|      |      |      |